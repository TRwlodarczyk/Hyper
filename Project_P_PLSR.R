
#libraries
{
  library(ggplot2)
  library(ggpubr)
  library(dplyr)
  library(data.table)
  library(reshape2)
  library(reshape)
  library("readxl")
  library(ggpubr)
  library(agricolae)
  library(tidyverse)
  library (readr) #to read URL
  library(stringr) # For str_replace_all
  library(psych)
  library(car)
  library(openxlsx)
  
}

setwd("C:/Users/twlodarczyk/OneDrive - University of Arizona/Desktop/All documents/1 PhD/CNRS + Synch/Hyperspectral Research/1_Experiment/1_Experiment_P/Spreadsheet/PLS")
dt <-read.delim("Project_P_pXRF_HP_Hyper.txt")

dt <- dt %>% 
  filter(Hyperspectral_measured == "Yes" &
           Leaf_Type == "pxrf")



#PLS-R
columns_to_remove <- c(
  "X2189", "X1697", "X1645", "X2326", "X1472", "X485", "X1345", "X1384", "X786", "X1473",
  "X1644", "X1297", "X2266", "X2099", "X1474", "X785", "X1711", "X1346", "X1383", "X1698",
  "X2325", "X2188", "X1643", "X784", "X1347", "X1475", "X1348", "X1710", "X1382", "X1476",
  "X1349", "X783", "X1296", "X2100", "X1699", "X1642", "X1350", "X1381", "X1477", "X2187",
  "X1086", "X1085", "X2324", "X1709", "X1084", "X2267", "X1351", "X1093", "X1700", "X1083",
  "X1089", "X1478", "X1090", "X1087", "X1092", "X782", "X1091", "X1094", "X1088", "X1380",
  "X1095", "X1641", "X1096", "X1097", "X1082", "X2101", "X1479", "X1352", "X1295", "X1708",
  "X1701", "X1379", "X1081", "X1098", "X2323", "X1480", "X781", "X1099", "X2186", "X1080",
  "X1100", "X1640", "X1353", "X1702", "X1378", "X1079", "X1101", "X1481", "X1294", "X1707",
  "X2102", "X1354"
)

# Remove the specified columns from the dataset
dt <- dt %>%
  select(-all_of(columns_to_remove))

#write.xlsx(dt, "Project_P_PLS-R.xlsx")




#PLS-R2

# Vector of columns to remove with "X" prefix
columns_to_remove <- c(
  "X2335", "X2090", "X974", "X1435", "X1327", "X827", "X1662", "X1436", "X1689", "X1397",
  "X1308", "X1782", "X1328", "X975", "X1437", "X1661", "X2198", "X1438", "X1329", "X826",
  "X1396", "X1781", "X1660", "X1439", "X2091", "X979", "X1307", "X1728", "X1729", "X2334",
  "X1727", "X1780", "X1440", "X1730", "X825", "X1659", "X1330", "X1690", "X978", "X1441",
  "X2261", "X1779", "X976", "X1722", "X1395", "X1658", "X1726", "X824", "X1724", "X1331",
  "X1778", "X1723", "X1306", "X1721", "X1442", "X1725", "X977", "X1733", "X2197", "X1443",
  "X980", "X1731", "X1332", "X2333", "X2092", "X981", "X1657", "X1735", "X982", "X1777",
  "X1734", "X1720", "X1732", "X1444", "X823", "X1776", "X1394", "X1445", "X1736", "X1333",
  "X1691", "X1305", "X1446", "X2332", "X1719", "X1656", "X1447", "X1448", "X983", "X2093",
  "X1334", "X1449", "X2196", "X1304", "X1393", "X1775", "X822", "X1451", "X1655", "X1450",
  "X1737", "X1718", "X1452", "X1692", "X2094", "X1453", "X1774", "X1335", "X1654", "X1454",
  "X1392", "X821", "X2262", "X1738", "X1773", "X1303", "X2329", "X1455", "X1717", "X2331",
  "X984", "X2195", "X1456", "X1336", "X1772", "X1653", "X1458", "X820", "X1739", "X1771",
  "X1457", "X819", "X1693", "X2095", "X1459", "X1391", "X1770", "X987", "X1716", "X1652",
  "X985", "X2328", "X1460", "X986", "X1337", "X1740", "X988", "X1302", "X2194", "X2330",
  "X1769", "X1461", "X818", "X1390", "X1651", "X1462", "X1741", "X2193", "X1768", "X1715",
  "X1694", "X989", "X1338", "X1463", "X816", "X2263", "X1464", "X1767", "X817", "X1301",
  "X1742", "X1765", "X1766", "X1389", "X2096", "X2192", "X1764", "X990", "X1763", "X1339",
  "X1650", "X991", "X1465", "X1714", "X815", "X1762", "X1466", "X994", "X1695", "X2264",
  "X1388", "X1743", "X2191", "X1467", "X1761", "X1340", "X1747", "X814", "X1300", "X1649",
  "X1748", "X1744", "X1760", "X1749", "X2097", "X995", "X1468", "X1745", "X813", "X1746",
  "X1759", "X1713", "X1750", "X1387", "X992", "X993", "X2327", "X1751", "X1758", "X1752",
  "X1341", "X1753", "X996", "X2190", "X1469", "X1757", "X1754", "X799", "X1755", "X1756",
  "X1648", "X798", "X1696", "X800", "X801", "X792", "X810", "X795", "X797", "X794", "X796",
  "X1470", "X793", "X809", "X802", "X1386", "X997", "X812", "X1342", "X1299", "X808", "X811",
  "X2098", "X791", "X805", "X804", "X2265", "X1647", "X807", "X1471", "X789", "X790", "X803",
  "X1646", "X998", "X806", "X1712", "X999", "X1343", "X1385", "X788", "X1344", "X1000", "X1298",
  "X787", "X2322", "X1703", "X1482", "X2185", "X1639", "X1706", "X1377", "X1704", "X1705",
  "X2103", "X1638", "X1483", "X1376", "X1355", "X1078", "X780", "X1102", "X2268", "X1077",
  "X1375", "X1356", "X2184", "X1103", "X2321", "X1484", "X1637", "X1076", "X2104", "X1374",
  "X1293", "X1104", "X1357", "X1485", "X1075", "X1373", "X2183", "X2320", "X779", "X1105",
  "X1636", "X1074", "X2105", "X1106", "X1486", "X1358", "X1372", "X2182", "X486", "X1073",
  "X1487", "X2319", "X1371", "X1107", "X1359", "X1292", "X1635", "X1360", "X1370", "X1488",
  "X1108", "X1072", "X1361", "X1369", "X1363", "X2318", "X2181", "X1364", "X1362", "X2317",
  "X1368", "X1366", "X1365", "X1367", "X1489", "X778", "X2106", "X1109", "X2302", "X2269",
  "X2303", "X1634", "X1291", "X1490", "X2301", "X1071", "X2180", "X1110", "X2316", "X2304",
  "X1491", "X2107", "X1633", "X1070", "X1290", "X1111", "X1492", "X2179", "X1069", "X2270",
  "X777", "X1493", "X2300", "X1067", "X1112", "X1632", "X1068", "X1001", "X2108", "X2178",
  "X1289", "X1494", "X1113", "X1066", "X2305", "X2299", "X2307", "X1495", "X1114", "X2306",
  "X1002", "X1631", "X1004", "X1003", "X2177", "X2310", "X1115", "X2315", "X1496", "X1005",
  "X1288", "X1006", "X2109", "X2311", "X1007", "X2308", "X2176", "X1497", "X1116", "X2309",
  "X1630", "X2298", "X1065", "X2314", "X2296", "X1008", "X1498", "X2313", "X776", "X2271",
  "X2297", "X1009", "X1010", "X1287", "X2175", "X1117", "X1629", "X2110", "X2312", "X1011",
  "X1064", "X1012", "X1499", "X2273", "X2111", "X2295", "X1013", "X1063", "X1015", "X1118",
  "X1014", "X1500", "X1628", "X1286", "X1016", "X2272", "X1062", "X1501", "X2174", "X1119",
  "X2112", "X1061", "X1060"
)

# Remove the specified columns from the dataset
dt <- dt %>%
  select(-all_of(columns_to_remove))

#write.xlsx(dt, "Project_P_PLS-R2.xlsx")





# Load necessary libraries
library(dplyr)

# Vector of columns to remove with "X" prefix
columns_to_remove <- c(
  "X1907", "X1969", "X1970", "X1906", "X1971", "X1972", "X450", "X1905", "X1973", "X1974",
  "X415", "X1975", "X1904", "X1976", "X1977", "X414", "X1978", "X1979", "X1903", "X1980",
  "X1981", "X1982", "X1983", "X1902", "X1984", "X451", "X1985", "X1986", "X1901", "X413",
  "X1987", "X1988", "X1989", "X1900", "X1990", "X410", "X1991", "X1992", "X452", "X1993",
  "X1899", "X1994", "X409", "X1995", "X1996", "X412", "X1997", "X1898", "X453", "X1998",
  "X1999", "X2000", "X2001", "X1897", "X2002", "X411", "X2003", "X2004", "X454", "X2005",
  "X2006", "X1896", "X2007", "X407", "X2008", "X2009", "X455", "X2010", "X408", "X1895",
  "X2011", "X2012", "X406", "X2013", "X456", "X2014", "X1894", "X2015", "X457", "X2449",
  "X2016", "X2448", "X2017", "X2446", "X2447", "X2018", "X2445", "X2440", "X1893", "X2019",
  "X2441", "X2443", "X2439", "X2444", "X458", "X2442", "X2020", "X2021", "X2438", "X2022",
  "X2436", "X2437", "X459", "X2023", "X1892", "X2024", "X2435", "X2025", "X2429", "X2432",
  "X2430", "X460", "X2026", "X2431", "X405", "X2433", "X2027", "X2426", "X1891", "X461",
  "X2425", "X2028", "X2424", "X2434", "X2428", "X2423", "X462", "X2029", "X2427", "X2030",
  "X1890", "X463", "X2031", "X472", "X2032", "X2033", "X2422", "X2034", "X464", "X1889",
  "X2035", "X401", "X468", "X471", "X2421", "X2414", "X473", "X2036", "X2415", "X2416",
  "X2413", "X2420", "X467", "X469", "X465", "X2417", "X2037", "X470", "X2419", "X2418",
  "X1888", "X466", "X2038", "X402", "X2410", "X2412", "X2404", "X2409", "X2403", "X2039",
  "X2411", "X2408", "X2407", "X2406", "X2040", "X2405", "X2402", "X2041", "X1887", "X2400",
  "X2401", "X475", "X2042", "X474", "X2399", "X2043", "X1886", "X2044", "X2398", "X404",
  "X403", "X2045", "X2397", "X863", "X864", "X868", "X867", "X862", "X2396", "X861", "X866",
  "X865", "X869", "X1885", "X2046", "X860", "X476", "X870", "X858", "X859", "X872", "X871",
  "X857", "X2394", "X873", "X856", "X2393", "X874", "X2395", "X855", "X2047", "X875", "X853",
  "X854", "X852", "X876", "X878", "X879", "X877", "X880", "X851", "X850", "X881", "X2392",
  "X2048", "X849", "X2390", "X848", "X847", "X882", "X883", "X884", "X2391", "X1884", "X885",
  "X2389", "X886", "X887", "X846", "X888", "X2049", "X845", "X889", "X844", "X843", "X2050",
  "X890", "X842", "X891", "X841", "X1883", "X892", "X840", "X2388", "X2051", "X893", "X839",
  "X896", "X894", "X477", "X895", "X2386", "X2387", "X897", "X838", "X2384", "X1882", "X2385",
  "X898", "X837", "X2052", "X899", "X900", "X2383", "X836", "X901", "X400", "X902", "X478",
  "X903", "X835", "X2053", "X1881", "X834", "X904", "X907", "X906", "X905", "X908", "X909",
  "X2054", "X833", "X910", "X2380", "X2382", "X832", "X912", "X911", "X913", "X831", "X1880",
  "X830", "X2379", "X915", "X916", "X829", "X2381", "X479", "X914", "X2055", "X917", "X918",
  "X828", "X919", "X920", "X1879", "X2056", "X922", "X921", "X923", "X2378", "X924", "X480",
  "X925", "X926", "X2377", "X2057", "X927", "X1878", "X928", "X2058", "X929", "X481", "X930",
  "X932", "X931", "X2376", "X933", "X2059", "X1877", "X934", "X2373", "X1876", "X937", "X936",
  "X935", "X1875", "X2060", "X938", "X2375", "X1874", "X2374", "X939", "X1873", "X942", "X2061",
  "X941", "X940", "X1872", "X943", "X947", "X2372", "X944", "X945", "X2062", "X946", "X1871",
  "X948", "X1870", "X2063", "X949", "X1869", "X950", "X1868", "X951", "X1867", "X1866", "X952",
  "X2369", "X2370", "X953", "X1865", "X956", "X2064", "X957", "X954", "X1864", "X955", "X2371",
  "X958", "X1863", "X2367", "X2368", "X959", "X962", "X2065", "X1862", "X960", "X961", "X2366",
  "X963", "X1861", "X2066", "X1860", "X965", "X484", "X964", "X1859", "X1858", "X966", "X1857",
  "X967", "X482", "X968", "X969", "X1856", "X2067", "X483", "X970", "X971", "X2365", "X972",
  "X1855", "X2363", "X2068", "X2364", "X2362", "X973", "X1854", "X2069", "X1853", "X1852",
  "X1851", "X1850", "X2361", "X2070", "X1849", "X2359", "X775", "X2360", "X1848", "X2071",
  "X1847", "X2358", "X2072", "X774", "X1846", "X1845", "X2073", "X1844", "X1843", "X2357",
  "X1842", "X2074", "X1841", "X773", "X2356", "X1840", "X2355", "X2075", "X1839", "X2354",
  "X1838", "X772", "X2076", "X1837", "X2077", "X2353", "X1836", "X1835", "X2241", "X2240",
  "X2352", "X2078", "X1834", "X2351", "X1833", "X2246", "X771", "X2242", "X2243", "X2239",
  "X2244", "X2247", "X2245", "X2350", "X1832", "X2079", "X2248", "X1831", "X2238", "X2349",
  "X2237", "X2249", "X2234", "X1830", "X2080", "X2348", "X2233", "X2236", "X770", "X1829",
  "X2235", "X2347", "X2250", "X1828", "X2081", "X2252", "X2251", "X2230", "X2232", "X1827",
  "X2228", "X2231", "X2229", "X2227", "X2346", "X1826", "X2253", "X2082", "X1825", "X2226",
  "X2224", "X1824", "X2223", "X2254", "X2225", "X2345", "X2222", "X1823", "X769", "X2221",
  "X2344", "X2083", "X1822", "X2343", "X2255", "X1821", "X2220", "X1819", "X1820", "X1818",
  "X2084", "X2219", "X1817", "X2218", "X2342", "X1816", "X2085", "X1815", "X2217", "X1059",
  "X2256", "X1311", "X1312", "X2216", "X1310", "X2341", "X1814", "X1309", "X1058", "X768",
  "X1313", "X2215", "X1813", "X1314", "X1413", "X1315", "X1412", "X2086", "X1416", "X1411",
  "X1417", "X1415", "X1414", "X1316", "X1418", "X2214", "X1812", "X1410", "X1057", "X2213",
  "X1317", "X1419", "X1409", "X2340", "X1318", "X1408", "X1056", "X1811", "X2212", "X1319",
  "X1420", "X1407", "X1810", "X2087", "X1055", "X2257", "X2339", "X1320", "X1421", "X2211",
  "X1809", "X1406", "X2088", "X1054", "X1120", "X1321", "X1422", "X2210", "X1808", "X1405",
  "X1053", "X1423", "X1322", "X1121", "X1807", "X1052", "X2209", "X1424", "X1800", "X1404",
  "X2338", "X1425", "X1017", "X1051", "X1122", "X2208", "X1806", "X1403", "X1799", "X1323",
  "X1018", "X1426", "X2207", "X2089", "X1022", "X2258", "X1021", "X1427", "X1050", "X1019",
  "X1402", "X1023", "X1020", "X1123", "X1798", "X1428", "X1805", "X1024", "X2337", "X1324",
  "X1049", "X1025", "X1037", "X487", "X1038", "X1028", "X1039", "X767", "X2206", "X1036",
  "X1029", "X1429", "X1401", "X1048", "X1027", "X1797", "X1124", "X1046", "X1026", "X1325",
  "X1047", "X1045", "X1030", "X1042", "X1040", "X1043", "X1031", "X1044", "X1804", "X1035",
  "X1430", "X2336", "X1032", "X1034", "X1041", "X1400", "X1033", "X1431", "X1326", "X1796",
  "X1803", "X1125", "X1432", "X2259", "X1399", "X1433", "X2205", "X1795", "X1802", "X1126",
  "X1434", "X2204", "X1801", "X1794", "X1398", "X2203", "X1127", "X2201", "X2202", "X1793",
  "X1128", "X2200", "X1792", "X1129", "X2260", "X1791", "X2199", "X1130", "X1790", "X1131",
  "X1789", "X766", "X1788", "X1132", "X1787", "X1676", "X1677", "X1675", "X1674", "X1678",
  "X1133", "X1673", "X1679", "X1786", "X1672", "X1671", "X1680", "X1670", "X1681", "X1785",
  "X1134", "X1682", "X1669", "X1683", "X1668", "X1784", "X1135", "X1684", "X1667", "X1685",
  "X1783", "X1666", "X1136", "X1686", "X1665", "X765", "X1137", "X1664", "X1687", "X1663",
  "X1138", "X1688", "X1139", "X1140", "X488", "X1141", "X1285", "X1142", "X1284", "X1143",
  "X1283", "X1144", "X1282", "X764", "X1145", "X1281", "X1280", "X1146", "X1279", "X1278",
  "X1147", "X1277", "X1148", "X1276", "X1275", "X1149", "X1274", "X1273", "X1272"
)

# Remove the specified columns from the dataset
dt <- dt %>%
  select(-all_of(columns_to_remove))

# View the updated dataframe
glimpse(dt)

#write.xlsx(dt, "Project_P_PLS-R3.xlsx")




# Load necessary libraries
library(dplyr)

# Vector of columns to remove with "X" prefix
columns_to_remove <- c(
  "X1920", "X1946", "X1919", "X1947", "X1948", "X1918", "X425", "X421", "X1949", "X1917",
  "X420", "X1950", "X1916", "X1915", "X1951", "X1952", "X1953", "X1954", "X1955", "X1914",
  "X1956", "X448", "X1913", "X1957", "X419", "X1912", "X1958", "X1959", "X1911", "X1960",
  "X1961", "X1962", "X1910", "X417", "X1963", "X449", "X1909", "X1964", "X1965", "X1908",
  "X1966", "X416", "X418", "X1967", "X1968", "X1150", "X1271", "X1270", "X1151", "X1269",
  "X1268", "X1152", "X1267", "X1266", "X1265", "X1153", "X1264", "X1263", "X1262", "X1154",
  "X489", "X1261", "X1260", "X1155", "X763", "X1259", "X1156", "X1258", "X1157", "X1257",
  "X1158", "X1159", "X1256", "X1160", "X1255", "X1254", "X2113", "X1161", "X1253", "X1162",
  "X2294", "X1252", "X2274", "X1502", "X2114", "X1163", "X1251", "X2293", "X1250", "X1503",
  "X1164", "X1249", "X1504", "X1165", "X2115", "X1248", "X2173", "X2292", "X1505", "X1247",
  "X1166", "X2172", "X2290", "X1246", "X2275", "X1167", "X2291", "X1506", "X2116", "X2289",
  "X1507", "X1245", "X2171", "X2281", "X1508", "X1168", "X2288", "X2276", "X2280", "X2282",
  "X1244", "X2117", "X1509", "X2279", "X2170", "X1169", "X1243", "X2118", "X2287", "X1510",
  "X2277", "X2169", "X1511", "X2283", "X2278", "X2119", "X1242", "X2120", "X1170", "X2284",
  "X1512", "X762", "X2121", "X1513", "X2168", "X1241", "X2286", "X1171", "X2285", "X1514",
  "X2122", "X1240", "X1515", "X1172", "X2123", "X1516", "X2167", "X1239", "X1517", "X1173",
  "X2124", "X1518", "X1238", "X2166", "X1174", "X1519", "X490", "X1237", "X2125", "X2165",
  "X1520", "X1236", "X1175", "X2163", "X2164", "X1521", "X1627", "X1235", "X2162", "X2126",
  "X1522", "X1176", "X1234", "X1626", "X1523", "X2127", "X2161", "X1524", "X2160", "X1233",
  "X2130", "X2159", "X1525", "X1177", "X1625", "X2131", "X2128", "X2132", "X1526", "X2158",
  "X2133", "X1232", "X2129", "X2134", "X1624", "X1527", "X2157", "X1178", "X2156", "X2135",
  "X1231", "X1528", "X2155", "X1623", "X1529", "X2136", "X1179", "X2154", "X1230", "X1530",
  "X2137", "X2153", "X2152", "X1229", "X2138", "X2151", "X1531", "X1180", "X1622", "X2150",
  "X1532", "X1228", "X2139", "X2147", "X2146", "X2148", "X2149", "X2145", "X2143", "X1533",
  "X2144", "X1621", "X1181", "X2140", "X2142", "X2141", "X1227", "X1534", "X1535", "X1620",
  "X761", "X1536", "X1182", "X1226", "X1537", "X1619", "X1538", "X1183", "X1225", "X1539",
  "X1618", "X1540", "X1224", "X1184", "X1617", "X1541", "X1542", "X1223", "X1185", "X1616",
  "X1543", "X1222", "X1544", "X1186", "X1615", "X1545", "X1221", "X1546", "X1614", "X1187",
  "X1547", "X1220", "X1548", "X1613", "X1188", "X1549", "X1219", "X1550", "X1612", "X1189",
  "X1218", "X1551", "X1217", "X1552", "X1611", "X1190", "X1216", "X1553", "X1610", "X1215",
  "X1191", "X1554", "X1192", "X1214", "X1555", "X1609", "X1193", "X1213", "X1556", "X1212",
  "X1194", "X1211", "X1608", "X1195", "X1557", "X1210", "X1209", "X1196", "X1558", "X1607",
  "X760", "X1559", "X1208", "X1197", "X1207", "X1560", "X1606", "X1206", "X1198", "X1199",
  "X1205", "X1200", "X1561", "X1204", "X1203", "X1201", "X1202", "X491", "X1605", "X1562",
  "X1604", "X1563", "X1603", "X1564", "X1602", "X1565", "X1601", "X1566", "X1600", "X1567",
  "X1599", "X1568", "X1569", "X1598", "X1570", "X1597", "X1571", "X1572", "X1596", "X1573",
  "X1574", "X1595", "X1575", "X1594", "X1576", "X1593", "X1592", "X1577", "X1591", "X1590",
  "X1578", "X1589", "X1588", "X1587", "X1579", "X1581", "X1582", "X1584", "X1583", "X1580",
  "X1586", "X1585", "X759", "X758", "X492", "X757", "X493", "X756", "X494", "X755", "X754",
  "X672", "X671", "X673", "X670", "X674", "X495", "X669", "X753", "X675", "X668", "X676",
  "X752", "X667", "X496", "X677", "X751", "X666", "X678", "X497", "X750", "X665", "X679",
  "X498", "X664"
)

# Remove the specified columns from the dataset
dt <- dt %>%
  select(-all_of(columns_to_remove))

# View the updated dataframe
glimpse(dt)

#write.xlsx(dt, "Project_P_PLS-R4.xlsx")




# Load necessary libraries
library(dplyr)

# Vector of columns to remove with "X" prefix
columns_to_remove <- c(
  "X1933", "X1931", "X1935", "X1928", "X1927", "X1930", "X1926", "X1929", "X447", "X1936",
  "X1925", "X1924", "X1937", "X1938", "X1940", "X1939", "X1923", "X1941", "X1942", "X1922",
  "X1943", "X1921", "X1944", "X1945", "X435", "X436", "X441", "X440", "X438", "X439", "X437",
  "X442", "X434", "X433", "X443", "X432", "X430", "X431", "X429", "X444", "X427", "X423", 
  "X428", "X424", "X445", "X446", "X422", "X426", "X1932", "X749", "X680", "X663", "X748", 
  "X499", "X681", "X662", "X747", "X500", "X661", "X682", "X746", "X660", "X501", "X659", 
  "X683", "X745", "X658", "X657", "X502", "X656", "X684", "X744", "X655", "X654", "X653", 
  "X503", "X652", "X743", "X651", "X685", "X650", "X504", "X649", "X742", "X648", "X686", 
  "X505", "X647", "X741", "X646", "X506", "X645", "X687", "X740", "X644", "X507", "X643", 
  "X739", "X688", "X642", "X508", "X641", "X640", "X738", "X509", "X639", "X689", "X638", 
  "X637", "X510", "X636", "X737", "X635", "X634", "X690", "X633", "X632", "X511", "X631", 
  "X630", "X629", "X628", "X627", "X626", "X625", "X736", "X624", "X623", "X622", "X512", 
  "X621", "X691", "X620", "X619", "X618", "X513", "X617", "X1934"
)

# Remove the specified columns from the dataset
dt <- dt %>%
  select(-all_of(columns_to_remove))

# View the updated dataframe
glimpse(dt)



#write.xlsx(dt, "Project_P_PLS-R5.xlsx")


#Create index 553 - 735 / 553 + 735

dt <- dt %>%
  mutate(VI553_735 = (X553 - X735) / (X553 + X735))

corr.test(dt$VI553_735, dt$Zn_PXRF_mean)



dt$Measure2 <- factor(dt$Measure2, levels = paste0("T", 0:10))

# Create the plot
ggplot(dt, aes(x = Zn_PXRF_mean, y = VI553_735, color = Measure2)) + 
  geom_point(size=3) +  # adds the scatter plot points
  theme_minimal() + 
  scale_color_manual(values = colorRampPalette(c("lightgrey", "black"))(length(levels(dt$Measure2)))) +
  labs(title = "ddd",
       x = "Zn conc in leaf",
       y = "VI553_735")



# Create the plot
ggplot(dt, aes(x = Zn_PXRF_mean, y = VI553_735, color = Status)) + 
  geom_point(size=3) +  # adds the scatter plot points
  theme_minimal() + 
  labs(title = "ddd",
       x = "Zn conc in leaf",
       y = "VI553_735")

colnames(dt)[149] #here the hyper cols starts 

##


### Compute the indicies 

# Load necessary libraries
library(dplyr)

# Get column names for the relevant columns (149 to 296)
relevant_columns <- names(dt)[149:296]

# Function to calculate the index for a pair of columns
calculate_index <- function(col1, col2) {
  (dt[[col1]] - dt[[col2]]) / (dt[[col1]] + dt[[col2]])
}

# Create a dataframe to hold the names of new indices and their R-squared values
results <- data.frame(Index = character(), R_squared = numeric(), stringsAsFactors = FALSE)

# Iterate over the pairs of columns to create new indices and calculate R-squared values
for (i in 1:(length(relevant_columns) - 1)) {
  for (j in (i + 1):length(relevant_columns)) {
    col1 <- relevant_columns[i]
    col2 <- relevant_columns[j]
    new_col_name <- paste(col1, col2, sep = "_")
    dt[[new_col_name]] <- calculate_index(col1, col2)
    
    # Calculate the R-squared value
    model <- lm(dt[[new_col_name]] ~ dt$Zn_PXRF_mean, data = dt)
    r_squared <- summary(model)$r.squared
    
    # Add the result to the results dataframe
    results <- rbind(results, data.frame(Index = new_col_name, R_squared = r_squared))
  }
}

# View the results dataframe
print(results)

write.xlsx(results, "Project_P_R-Squared_from_PLS-bands_normalized_index.xlsx")
